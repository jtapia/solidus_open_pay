<!-- <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> -->
<%# <script type="text/javascript" src="https://js.openpay.mx/openpay.v1.min.js"></script> %>
<%# <script type='text/javascript' src="https://js.openpay.mx/openpay-data.v1.min.js"></script> %>

<script type="text/javascript" src="https://resources.openpay.mx/lib/openpay.v1.min.js"></script>

<script type="text/javascript">
  OpenPay.setId('<%= payment_method.preferred_merchant_id %>');
  OpenPay.setApiKey("<%= payment_method.preferred_public_key %>");
  OpenPay.setSandboxMode(true);
  <%# # bill_address = current_order.bill_address
  # options = {
  #   elementsInitialization: {
  #     mode: 'payment', # 'payment' or 'setup'
  #     amount: SolidusStripe::MoneyToStripeAmountConverter.to_stripe_amount(
  #       current_order.display_order_total_after_store_credit.money.fractional,
  #       current_order.currency,
  #     ),
  #     currency: current_order.currency.downcase,
  #     paymentMethodCreation: 'manual',
  #     captureMethod: payment_method.auto_capture? ? 'automatic' : 'manual',

  #     # If you want to allow the display/use of specific payment method types
  #     # activated from the Stripe Dashboard, you can use this option.
  #     #
  #     # For a complete list of payment method types available on Stripe:
  #     # https://stripe.com/docs/payments/payment-methods/overview
  #     # https://stripe.com/docs/api/payment_methods/object#payment_method_object-type
  #     #
  #     # To activate/deactivate Stripe payment methods:
  #     # https://dashboard.stripe.com/settings/payment_methods
  #     # paymentMethodTypes: ['card', 'sepa_debit'],

  #     # Fully customizable with appearance API.
  #     # https://stripe.com/docs/elements/appearance-api
  #     # appearance: {},
  #   },
  #   paymentElementCreation: {
  #     layout: "tabs",
  #     defaultValues: {
  #       billingDetails: {
  #         name: bill_address.name,
  #         email: current_order.email,
  #         phone: bill_address.phone,
  #         address: {
  #           line1: bill_address.address1,
  #           line2: bill_address.address2,
  #           city: bill_address.city,
  #           state: bill_address.state.abbr,
  #           country: bill_address.country.iso,
  #           postal_code: bill_address.zipcode,
  #         }
  #       }
  #     },
  #   },
  # } %>
 </script>

<div
  class="solidus-open-pay-payment"
  data-controller="solidus-open-pay-payment"
  data-solidus-open-pay-payment-merchant-id-value="<%= payment_method.preferred_merchant_id %>"
  data-solidus-open-pay-payment-private-key-value="<%= payment_method.preferred_private_key %>"
  data-solidus-open-pay-payment-country-value="<%= payment_method.preferred_country %>"
  data-solidus-open-pay-payment-sandbox-value="<%= !Rails.env.production? %>"
  data-action="submit@window->solidus-open-pay-payment#handleSubmit"
>
  <input
    type="hidden"
    name="payment_source[<%= payment_method.id %>][stripe_payment_method_id]"
    value=""
    data-solidus-stripe-payment-target="paymentMethodInput"
  >

  <div data-solidus-stripe-payment-target="paymentElement">
    <!-- Elements will create form elements here -->
    <em><%= t('solidus_stripe.loading') %></em>
  </div>

  <div data-solidus-stripe-payment-target="message">
    <!-- Display error/notification messages to your customers here -->
  </div>
</div>


<%# <script type="text/javascript">
 $(document).ready(function() {
  OpenPay.setId('mzdtln0bmtms6o3kck8f');
  OpenPay.setApiKey('pk_f0660ad5a39f4912872e24a7a660370c');
  var deviceSessionId = OpenPay.deviceData.setup("payment-form", "deviceIdHiddenFieldName");
  });
</script>
 %>
